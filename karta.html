---
layout: default
title: eHälsokartan
description: "Karta över Sveriges eHälsa"
sitemap:
  exclude: 'yes'
karta: true
---
<!--
sitemap:
  lastmod: 2021-08-10
  priority: 0.8
  changefreq: 'weekly'
-->
<style>
    .karta {
        display: flex;
        flex-direction: row;
        max-width: 1000px;
        margin-left: auto;
        margin-right: auto;
    }
    .karta h2 {
        font-size: 1.2rem;
    }
    .karta select {
        margin-right: 10px;
        margin-left: 10px;
        font-size: 1rem;
        font-family: 'Poppins', sans-serif;
        font-weight: 200;
        box-sizing: border-box;
        max-width: 90%;
    }
    .karta-list {
        width: 70%;
    }
    .karta-map {
        width: 30%;
    }
    .karta-list .karta-col {
        display: flex;
        flex-direction: row;
    }
    .karta-list .karta-col ul {
        width: 50%;
    }
    .karta-list .karta-col a {
        display: block;
        text-decoration: none;
        color: #000;
    }
    .karta-list .karta-col a:hover {
        text-decoration: underline;
    }
    .karta-sticky {
        position: -webkit-sticky;
        position: sticky;
        top: 0;
    }
    @media only screen and (max-width: 600px) {
        .karta {
            flex-direction: row-reverse;
        }
        .karta-list .karta-col {
            flex-direction: column;
        }
        .karta-list {
            width: 60%;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        .karta-map {
            width: 40%;
        }
        .karta-list ul {
            margin-top: 0px;
            margin-bottom: 0px;
        }
    }
</style>
<section class="karta">
    <div class="karta-list">
        <h1>eHälsokartan</h1>
        <label for="filter" style="display: none;">Välj region för att filtrera på kartan</label>
        <select name="filtrera" id="filter" onchange="filter(this);">
            <option value="">Alla Regioner</option>
            <option value="Region Blekinge">Region Blekinge</option>
            <option value="Region Dalarna">Region Dalarna</option>
            <option value="Region Gotland">Region Gotland</option>
            <option value="Region Gävleborg">Region Gävleborg</option>
            <option value="Region Halland">Region Halland</option>
            <option value="Region Jämtland Härjedalen">Region Jämtland Härjedalen</option>
            <option value="Region Jönköpings län">Region Jönköpings län</option>
            <option value="Region Kronoberg">Region Kronoberg</option>
            <option value="Region Kalmar län">Region Kalmar län</option>
            <option value="Region Norrbotten">Region Norrbotten</option>
            <option value="Region Skåne">Region Skåne</option>
            <option value="Region Stockholm">Region Stockholm</option>
            <option value="Region Sörmland">Region Sörmland</option>
            <option value="Region Uppsala">Region Uppsala</option>
            <option value="Region Värmland">Region Värmland</option>
            <option value="Region Västerbotten">Region Västerbotten</option>
            <option value="Region Västernorrland">Region Västernorrland</option>
            <option value="Region Västmanland">Region Västmanland</option>
            <option value="Västra Götalandsregionen">Västra Götalandsregionen</option>
            <option value="Region Örebro län">Region Örebro län</option>
            <option value="Region Östergötland">Region Östergötland</option>
        </select>
        <div id="Inkubatorer" style="display: none;">
            <h2>Inkubatorer</h2>
            <div class="karta-col min">
                <ul></ul>
                <ul></ul>
            </div>
        </div>
        <div id="Forskning" style="display: none;">
            <h2>Forskning</h2>
            <div class="karta-col min">
                <ul></ul>
                <ul></ul>
            </div>
        </div>
    </div>
    <div class="karta-map">
        <div class="karta-sticky">
            <div id="karta1" style="height: 100vh;"></div>
        </div>
    </div>
</section>
<script src="/assets/js/papaparse.min.js"></script>
<script src="/assets/js/koordinater.js"></script>
<style id="markerOnTop"></style>
<style id="filterStyle"></style>
<script>
    function rensaKarta(){
        var def = document.getElementsByClassName('leaflet-marker-icon');
        for (let a = 0; a < def.length; a++) {
            def[a].setAttribute('src', def[a].getAttribute('src').replace('-highlight.svg', '.svg'));
        };
        document.getElementById('markerOnTop').innerText = '';
    };
    function highlight(c){
        rensaKarta();
        document.getElementById('markerOnTop').innerText = '.' + c + ' { z-index: 9999!important };'
        var icons = document.getElementsByClassName(c);
        for (let i = 0; i < icons.length; i++) {
            icons[i].setAttribute('src', icons[i].getAttribute('src').replace('.svg', '-highlight.svg'));
        };
    };
    function makeID(region){
        return region.replace(/[^A-Za-z0-9]/g,"").toLowerCase();
    };
    function filter(el){
        if(el.value == ''){
            document.getElementById('filterStyle').innerText = '';
            mymap.setView([62.5, 17.5], 5);
        }else{
            document.getElementById('filterStyle').innerText = '.karta-filter { display: none; } .karta-filter-list-' + makeID(el.value) + ' { display: list-item; } .karta-filter-marker-' + makeID(el.value) + ' { display: block; }';
            mymap.setView(JSON.parse('[' + getRegionKor(el.value) + ']'), 7);
        };
    };
    var mymap = L.map('karta1').setView([62.5, 17.5], 5);
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoidGVkZHlrbGFkZGthayIsImEiOiJja3NsazF6aTkwcDQyMnBudTRveW40bDByIn0.UOrVx1Mt69ZPKCJEpdwwjQ'
        }).addTo(mymap);
    Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vS5_gAmo9oFPsMDGmQ-LyIf7i2ZEySuEg9RMS4FQ3sPXJWEd1VholZELScFzCZbJ5Skbs1av6C_L7Lm/pub?output=csv", {
        download: true,
        step: function(row) {
            if(row.data[0] == "Namn"){}else{
                var unikID = 'karta-' + Math.random().toString(36).substr(2, 9);
                var filter = makeID(row.data[2]) + ' karta-filter';
                var circleIcon = L.icon({iconUrl: '/assets/css/leaflet/circle.svg', iconSize: [30, 30], iconAnchor: [15, 15], popupAnchor: [0, 0], className: unikID + ' karta-filter-marker-' + filter});
                if(!row.data[4] == ""){
                    var koordinat = row.data[4];
                }else if(!row.data[3] == ""){
                    var koordinat = getStadKor(row.data[3]);
                }else if(!row.data[2] == ""){
                    var koordinat = getRegionKor(row.data[2]);
                }else{
                    console.log('Koordinat fattas för: ' + row.data[0]);
                };
                var alreadyUsed = checkUsedKor(koordinat);
                if(!alreadyUsed){
                    var koordinatObj = JSON.parse('[' + koordinat + ']');
                    L.marker(koordinatObj, {icon: circleIcon}).bindPopup('<a href="' + row.data[5] + '">' + row.data[0] + '</a>', {className: unikID.replace('karta-', 'karta-popup-')}).addTo(mymap);
                    usedKor.push({kor: koordinat, id: unikID});
                }else{
                    mymap.eachLayer(function(feature){
                        if(!feature._icon){}else{
                            if(feature._icon.className.includes(alreadyUsed)){
                                var newContent = feature.getPopup()._content + '<br/><a href="' + row.data[5] + '">' + row.data[0] + '</a>';
                                feature.setPopupContent(newContent);
                            };
                        };
                    });
                    var unikID = alreadyUsed;
                };
                var headWrapper = document.getElementById(row.data[1]);
                    headWrapper.removeAttribute('style');
                var wrapper = headWrapper.getElementsByClassName('karta-col')[0];
                var checkUl = wrapper.getElementsByTagName('ul');
                    var li = document.createElement('li');
                        li.setAttribute('class', 'karta-filter-list-' + filter);
                        var liA = document.createElement('a');
                            liA.setAttribute('href', row.data[5]);
                            liA.setAttribute('onmouseover', 'highlight("' + unikID + '");');
                            liA.setAttribute('onmouseout', 'rensaKarta();');
                            var liAText = document.createTextNode(row.data[0]);
                            liA.appendChild(liAText);
                        li.appendChild(liA);
                if(checkUl[0].getElementsByTagName('li').length <= checkUl[1].getElementsByTagName('li').length){
                    checkUl[0].appendChild(li);
                }else{
                    checkUl[1].appendChild(li);
                };
            };
        },
        complete: function(results) {
            
        },
        error: function(results) {
            console.log('Något gick fel');
            var wrapper = document.getElementById('event-wrapper');
                wrapper.setAttribute('style', 'text-align: center;');
                var errmessage = document.createElement('p');
                    errmessage.setAttribute('class', 'err-message light-bg');
                    var errmessagetext = document.createTextNode('Kunde inte ladda event, testa att ladda om sidan.');
                    errmessage.appendChild(errmessagetext);
                wrapper.appendChild(errmessage);
                var reloadbutton = document.createElement('input');
                    reloadbutton.setAttribute('type', 'button');
                    reloadbutton.setAttribute('value', 'Ladda om');
                    reloadbutton.setAttribute('onclick', 'location.reload();');
                wrapper.appendChild(reloadbutton);
        }
    });
</script>