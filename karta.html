---
layout: default
title: Karta
description: "Karta över Sveriges eHälsa"
sitemap:
  exclude: 'yes'
karta: true
---
<!--
sitemap:
  lastmod: 2021-08-10
  priority: 0.8
  changefreq: 'weekly'
-->
<style>
    .karta {
        display: flex;
        flex-direction: row;
        max-width: 1000px;
        margin-left: auto;
        margin-right: auto;
    }
    .karta-list {
        width: 70%;
    }
    .karta-map {
        width: 30%;
    }
    .karta-list .karta-col {
        display: flex;
        flex-direction: row;
    }
    .karta-list .karta-col a {
        text-decoration: none;
        color: #000;
    }
    .karta-list .karta-col a:hover {
        text-decoration: underline;
    }
    .karta-sticky {
        position: -webkit-sticky;
        position: sticky;
        top: 0;
    }
    @media only screen and (max-width: 600px) {
        .karta {
            flex-direction: row-reverse;
        }
        .karta-list .karta-col {
            flex-direction: column;
        }
        .karta-list {
            width: 60%;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        .karta-map {
            width: 40%;
        }
        .karta-list ul {
            margin-top: 0px;
            margin-bottom: 0px;
        }
    }
</style>
<section class="karta">
    <div class="karta-list">
        <div id="Inkubatorer">
            <h2>Inkubatorer</h2>
            <div class="karta-col min">
                <ul></ul>
                <ul></ul>
            </div>
        </div>
        <div id="Forskning">
            <h2>Forskning</h2>
            <div class="karta-col min">
                <ul></ul>
                <ul></ul>
            </div>
        </div>
    </div>
    <div class="karta-map">
        <div class="karta-sticky">
            <div id="karta1" style="height: 100vh;"></div>
        </div>
    </div>
</section>
<script src="/assets/js/papaparse.min.js"></script>
<script src="/assets/js/koordinater.js"></script>
<script>
    function rensaKarta(){
        var def = document.getElementsByClassName('leaflet-marker-icon');
        for (let a = 0; a < def.length; a++) {
            def[a].setAttribute('src', def[a].getAttribute('src').replace('-highlight.svg', '.svg'));
        };
    };
    function highlight(c){
        rensaKarta();
        var icons = document.getElementsByClassName(c);
        for (let i = 0; i < icons.length; i++) {
            icons[i].setAttribute('src', icons[i].getAttribute('src').replace('.svg', '-highlight.svg'));
        };
    };
    var mymap = L.map('karta1').setView([62.5, 17.5], 5);
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoidGVkZHlrbGFkZGthayIsImEiOiJja3NsazF6aTkwcDQyMnBudTRveW40bDByIn0.UOrVx1Mt69ZPKCJEpdwwjQ'
        }).addTo(mymap);
    Papa.parse("https://docs.google.com/spreadsheets/d/e/2PACX-1vS5_gAmo9oFPsMDGmQ-LyIf7i2ZEySuEg9RMS4FQ3sPXJWEd1VholZELScFzCZbJ5Skbs1av6C_L7Lm/pub?output=csv", {
        download: true,
        step: function(row) {
            if(row.data[0] == "Namn"){}else{
                var unikID = 'karta-' + Math.random().toString(36).substr(2, 9);
                var circleIcon = L.icon({iconUrl: '/assets/css/leaflet/circle.svg', iconSize: [30, 30], iconAnchor: [15, 15], popupAnchor: [0, 0], className: unikID});
                if(!row.data[4] == ""){
                    var koordinat = row.data[4];
                }else if(!row.data[3] == ""){
                    var koordinat = getStadKor(row.data[3]);
                }else if(!row.data[2] == ""){
                    var koordinat = getRegionKor(row.data[2]);
                }else{
                    console.log('Koordinat fattas för: ' + row.data[0]);
                };
                var alreadyUsed = checkUsedKor(koordinat);
                if(!alreadyUsed){
                    var koordinatObj = JSON.parse('[' + koordinat + ']');
                    L.marker(koordinatObj, {icon: circleIcon}).bindPopup('<a href="' + row.data[5] + '">' + row.data[0] + '</a>', {className: unikID.replace('karta-', 'karta-popup-')}).addTo(mymap);
                    usedKor.push({kor: koordinat, id: unikID});
                }else{
                    mymap.eachLayer(function(feature){
                        if(!feature._icon){}else{
                            if(feature._icon.className.includes(alreadyUsed)){
                                var newContent = feature.getPopup()._content + '<br/><a href="' + row.data[5] + '">' + row.data[0] + '</a>';
                                feature.setPopupContent(newContent);
                            };
                        };
                    });
                    var unikID = alreadyUsed;
                };
                var wrapper = document.getElementById(row.data[1]).getElementsByClassName('karta-col')[0];
                var checkUl = wrapper.getElementsByTagName('ul');
                    var li = document.createElement('li');
                        var liA = document.createElement('a');
                            liA.setAttribute('href', row.data[5]);
                            liA.setAttribute('onmouseover', 'highlight("' + unikID + '");');
                            liA.setAttribute('onmouseout', 'rensaKarta();');
                            var liAText = document.createTextNode(row.data[0]);
                            liA.appendChild(liAText);
                        li.appendChild(liA);
                if(checkUl[0].getElementsByTagName('li').length <= checkUl[1].getElementsByTagName('li').length){
                    checkUl[0].appendChild(li);
                }else{
                    checkUl[1].appendChild(li);
                };
            };
        },
        complete: function(results) {
            
        },
        error: function(results) {
            console.log('Något gick fel');
            var wrapper = document.getElementById('event-wrapper');
                wrapper.setAttribute('style', 'text-align: center;');
                var errmessage = document.createElement('p');
                    errmessage.setAttribute('class', 'err-message light-bg');
                    var errmessagetext = document.createTextNode('Kunde inte ladda event, testa att ladda om sidan.');
                    errmessage.appendChild(errmessagetext);
                wrapper.appendChild(errmessage);
                var reloadbutton = document.createElement('input');
                    reloadbutton.setAttribute('type', 'button');
                    reloadbutton.setAttribute('value', 'Ladda om');
                    reloadbutton.setAttribute('onclick', 'location.reload();');
                wrapper.appendChild(reloadbutton);
        }
    });
</script>